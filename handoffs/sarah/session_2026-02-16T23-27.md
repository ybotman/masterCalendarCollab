# Session Handoff: Sarah @ 2026-02-17T00:30

## Current Status
TIEMPO-381 race condition fixes deployed to TEST, mapCenter modal fix confirmed working.

## Active Ticket
- **Ticket**: TIEMPO-381
- **Status**: in_progress (TEST verified, PROD pending)

## What I Did This Session
- Diagnosed onboarding modal showing incorrectly for logged-in users with saved mapCenter
- Analyzed HAR files from PROD/TEST - found race condition: 2 parallel `/api/mapcenter` calls
- Fixed UserLocationLoader: moved `hasFetched` flag BEFORE async call to prevent React StrictMode double-fetch
- Found same race condition causing 429 rate limit errors on `/api/geo/google-geolocate`
- Fixed trackingHelper: added `fetchInProgress` guard to dedupe parallel calls
- Removed debug/test pages: /geo-diagnostics, /test-modal, /test-venue-geocode
- Version bumped to v1.19.11 (page removal) - deployed to PROD
- Race condition fixes on TEST only (not PROD yet)

## Next Session Should
1. Verify geolocate 429 fix deployed to TEST (check for `[Tracking] Fetch already in progress` log)
2. If TEST passes, deploy race condition fixes to PROD
3. Remove debug console.log statements before PROD deploy
4. Consider creating TIEMPO-382 for visitor sessionStorage flow (per Fulton's message)

## Key Decisions Made
- Set hasFetched ref BEFORE async call, not inside: prevents React StrictMode race
- Use singleton promise pattern for geolocate: all parallel callers await same fetch

## Context for Future Me
- HAR files in ~/Downloads/ (tangotiempo.com.har, test2.tangotiempo.com.har)
- PROD is on v1.19.11 (page removals only, no race fixes)
- TEST has race fixes but build may not have deployed yet
- User (El Gotan) said "DEVL only" for future changes until verified
- Fulton sent message about visitor location flow - new feature after this bug is resolved
