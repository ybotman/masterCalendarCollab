# Session Handoff: Sarah @ 2026-02-17T00:45

## Current Status
Fixed Boston route location overwrite bug, but new issue discovered - location pill missing nearest city name.

## Active Ticket
- **Ticket**: TIEMPO-381
- **Status**: In progress - fix deployed to TEST but regression found

## What I Did This Session
- Diagnosed /boston route showing fewer events than regular TT calendar
- Root cause: UserLocationLoader was fetching user's saved mapCenter and overwriting Boston's hardcoded coordinates (42.3601, -71.0589)
- Evidence from HAR files showed 3 API calls - first with user location, second with Boston, third back to user location
- Fixed in two places:
  1. `UserLocationLoader.js` - Skip fetchMapCenter entirely on /boston route
  2. `GeoLocationContext.js` - Respect `locked` flag when updating currentLocation
- Deployed fix to TEST (commit b7ca5f7)

## NEW ISSUE DISCOVERED
**Location pill is missing nearest city name** - only showing lat/long instead of city name like "Boston Â± 200mi"

Likely related to the fix - need to investigate how the location display text is generated and whether it depends on fetching nearest city data.

## Files Changed This Session
- `src/app/components/UserLocationLoader.js` - Skip mapCenter fetch on /boston
- `src/app/contexts/GeoLocationContext.js` - Respect locked flag, don't overwrite locked locations

## Next Session Should
1. Investigate why location pill is not showing city name
2. Check `locationDisplayText` computation in GeoLocationContext
3. May need to fetch nearest city name separately without overwriting location
4. Test /boston route on TEST to verify fix works
5. Verify the missing events (Tango Structure, Thursday ANDI/ULTIMATE) now appear

## Key Decisions Made
- Skip UserLocationLoader entirely on Boston route (vs just skipping onboarding)
- Use `locked` flag pattern to protect hardcoded locations from being overwritten

## Context for Future Me
- User's saved mapCenter: lat=42.236224, lng=-70.992423 (Marshfield area, ~25mi SE of Boston)
- Boston hardcoded: lat=42.3601, lng=-71.0589 (downtown)
- Both use 200mi radius, but different center points caused downtown Boston events to be filtered
- The fix prevents UserLocationLoader from overwriting, but may have broken city name display
