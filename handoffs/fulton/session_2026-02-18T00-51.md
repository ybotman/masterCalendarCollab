# Session Handoff: Fulton @ 2026-02-18T00:55

## ðŸŽ‰ PROD OUTAGE RESOLVED

CalendarBEAF-PROD is back online and fully functional.

## Root Causes Found

### 1. Reserved Route Conflict
Azure Functions reserves `/admin/*` routes for internal management.
- Backup_Firebase.js and Backup_MongoDB.js used `admin/backup/*`
- This caused "The specified route conflicts with one or more built in routes"
- **FIX**: Changed to `ops/backup/*`

### 2. .gitignore Blocking node_modules
`.gitignore` had `node_modules/` which caused `func azure functionapp publish` to exclude ALL npm packages.
- Deployments were only 251KB (just source files)
- No `@azure/functions` package = no function registration
- **FIX**: Use `az functionapp deployment source config-zip` with manual zip

## Deployment Method That Works

```bash
# Create zip WITH node_modules
zip -r /tmp/deploy.zip . -x "*.git*" -x "tests/*" -x "coverage/*" -x "*.ts" -x "backups/*" -x "docs/*" -x "logs/*"

# Deploy using Azure CLI
az functionapp deployment source config-zip --name CalendarBEAF-PROD --resource-group CalendarBEAF --src /tmp/deploy.zip
```

## Changes Made This Session
- `src/functions/Backup_Firebase.js`: admin/backup/* â†’ ops/backup/*
- `src/functions/Backup_MongoDB.js`: admin/backup/* â†’ ops/backup/*
- `docs/PROD-OUTAGE-RESEARCH-PROMPT.md`: Documented root causes

## Git Status
- Committed fix to PROD branch
- Need to merge to TEST and main branches

## Next Session Should
1. Merge route fix to TEST and main branches
2. Consider updating .funcignore or deployment scripts
3. Monitor PROD for stability
