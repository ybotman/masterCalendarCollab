{
  "from": "sarah",
  "to": ["sarah"],
  "subject": "Session Context: AF Migration Gap Analysis - 2026-01-29",
  "ticket": "TIEMPO-329",
  "priority": "high",
  "timestamp": "2026-01-29T21:30:00.000Z",
  "body": "SELF-NOTE FOR SESSION RESTART\n\n## What We Did This Session\n\nEl Gotan asked me to research the BE-to-AF migration, audit what the FE needs, and produce a gap analysis for Fulton (AF backend agent). Four parallel scouts gathered: migration docs, agent messages, full API inventory (52 endpoints), and 1.15.x commit history.\n\n## Key Documents\n\n- MIGRATION_LOG.md -- Full endpoint audit, files migrated, deployment strategy\n- MIGRATION_PLAN.md -- Original migration plan by Quinn\n- src/app/utils/apiUrlResolver.js -- Central URL resolver (feature flag NEXT_PUBLIC_AF_ENABLED)\n- docs/AZURE-FUNCTIONS-INTEGRATION.md -- AF monitoring/health integration\n\n## Current State\n\n- TT Version: 1.15.3 on DEVL\n- 28 FE files migrated to use apiUrlResolver.js\n- NEXT_PUBLIC_AF_ENABLED=true in .env.local (local dev points at AF)\n- Migration branch (migrate-tt-to-functions) merged into both DEVL and TEST\n- NOT merged to PROD\n\n## FINAL GAP ANALYSIS (After Deep Audit With El Gotan)\n\n### Tier 1 -- Confirmed Missing AF Endpoints (4 total, 2 real blockers)\n\n1. POST /api/events/upload-image - MEDIUM - Event image uploads\n2. POST /api/organizers/generate-sas-token - MEDIUM - Organizer image SAS tokens\n3. POST /api/frontend-logs - LOW - Disabled in FE 1.15.3\n4. POST /api/frontend-logs/batch - LOW - Disabled in FE 1.15.3\n\n### DROPPED (El Gotan confirmed not needed)\n\n- ALL /api/masteredLocations/* (5 endpoints) -- Every UI path disconnected: LocationSelector hardcoded off, LocationContextModal removed from sidebar, GeoLocationContext skips auto-fetch, VenueModalList filter dropdowns deprecated. Nearest mastered city display comes from /api/venues/geocode not masteredLocations.\n- GET /api/regions/activeRegions -- RegionMenu fully commented out of SidebarDrawer. SSR page (organizers/[slug]) handled via Option A: set NEXT_PUBLIC_BE_URL to AF URL at cutover.\n\n### Tier 2 -- Sub-Routes to Verify in Existing AF Functions (13 items)\n\n6. GET /api/events/summary (explorer map clusters)\n7. GET /api/events/count (count by ownerId)\n8. GET /api/venues/geocode (address geocoding + mastered city assignment -- CRITICAL)\n9. GET /api/venues/check-proximity (duplicate venue detection)\n10. POST /api/venues/check-proximity (same, POST variant)\n11. GET /api/organizers/firebase/:fbId\n12. POST /api/organizers (create)\n13. PUT /api/organizers/:organizerId (update)\n14. GET /api/userlogins/all (admin list)\n15. POST /api/userlogins/ (create on first login)\n16. POST /api/userlogins/activate-organizer\n17. PUT /api/userlogins/updateUserInfo\n18. PUT /api/userlogins/:fbId/roles\n\n### Tier 3 -- Infrastructure (5 items)\n\n19. Firebase auth parity\n20. CORS (localhost:3001, tangotiempo.com, test.tangotiempo.com)\n21. Error response format ({error, message, statusCode})\n22. MongoDB Atlas IP whitelist for AF\n23. Rate limiting\n\n### Already Confirmed Working in AF\n\n- GET /api/events (list + by ID) -- Parity YES\n- GET /api/categories -- Parity YES\n- GET /api/roles -- Parity YES\n- GET /api/venues (list + by ID) -- Parity YES\n- GET /api/organizers (list + by ID) -- Parity YES\n- GET /api/userlogins/firebase/:id -- Confirmed\n- POST/PUT/DELETE /api/events (standard + RA) -- Confirmed\n- POST/PUT/DELETE /api/venues -- EXISTS\n- All AF-only endpoints (tracking, mapcenter, geo proxies) -- Already in production\n\n### Cutover Plan (El Gotan approved Option A)\n\n1. Flip NEXT_PUBLIC_AF_ENABLED=true -- client calls go to AF\n2. Set NEXT_PUBLIC_BE_URL to AF URL -- SSR pages also go to AF\n3. Express BE decommissioned\n\n## Messages Sent\n\n- Sent Fulton msg_sarah_001 (original gap analysis) and msg_sarah_002 (corrected, reduced gap list) to calendar-be-af/inbox/fulton/\n- Waiting for Fulton's reply on Tier 2 verification\n\n## Also This Session\n\n- Modified SignupPromptContent.js -- Added 'and get rid of these annoying messages' to subtitle, added 'Follow out-of-default map events and organizers' benefit item\n\n## Next Steps\n\n- Wait for Fulton's Tier 2 reply\n- Consider JIRA ticket for gap closure tracking\n- Consider cleanup ticket for dead mastered locations / region code\n- El Gotan may want to check Fulton's earlier message (sent to Documents path, not accessible from MyDocs)"
}
