{
  "from": "sarah",
  "to": ["sarah"],
  "cc": ["gotan"],
  "subject": "CUTOVER PLAN + BACKOUT PLAN — FE PROD Deploy + AF_ENABLED=true",
  "ticket": "TIEMPO-329",
  "priority": "urgent",
  "timestamp": "2026-01-30T22:00:00.000Z",
  "type": "self-note",
  "body": "SELF-NOTE: Cutover and backout plan for AF migration.\n\n## CUTOVER PLAN\n\n### Step 1: Merge FE to PROD\n- Merge DEVL -> TEST (if not already current)\n- Merge TEST -> PROD\n- Vercel auto-deploys on PROD branch push\n- AF_ENABLED stays FALSE initially\n- Verify: RRULE fixes work, site loads, Express still serving traffic\n\n### Step 2: Flip AF_ENABLED=true in Vercel\n- Set NEXT_PUBLIC_AF_ENABLED=true in Vercel PROD env vars\n- Set NEXT_PUBLIC_AF_URL=https://calendarbeaf-prod.azurewebsites.net\n- Set NEXT_PUBLIC_BE_URL=https://calendarbeaf-prod.azurewebsites.net (for SSR pages)\n- Redeploy Vercel PROD to pick up env var changes\n- Verify: AF invocation report shows CRUD traffic (Events_Get, Organizers_Get, etc.)\n\n### Step 3: Monitor\n- Watch AF invocation report for 24h\n- Check App Insights for errors\n- Spot-check: calendar loads, event creation, organizer views, venue search\n\n## BACKOUT PLAN\n\n### If FE deploy breaks (Step 1 fails):\n- Revert PROD branch: git revert or git reset to previous PROD commit (3db0fd0)\n- Vercel auto-redeploys on push\n- Users back on v1.15.0 within minutes\n- Command: git checkout PROD && git reset --hard 3db0fd0 && git push --force origin PROD\n\n### If AF cutover breaks (Step 2 fails):\n- FASTEST (< 1 min): Change NEXT_PUBLIC_AF_ENABLED to 'false' in Vercel PROD env vars\n- Trigger Vercel redeploy (Vercel dashboard or vercel --prod)\n- All FE traffic reverts to Express BE immediately on redeploy\n- Express is still running — no action needed on backend\n- DO NOT turn off Express until AF is stable for 7+ days\n\n### If specific endpoints fail on AF:\n- Option A: Flip entire flag to false (full rollback to Express)\n- Option B: Cannot do partial — the flag is all-or-nothing\n- If partial rollback is needed, we'd need to modify apiUrlResolver.js to exclude specific endpoints\n\n### Express BE status:\n- Express MUST stay running throughout cutover and stabilization\n- Do NOT decommission Express until AF has been stable for minimum 7 days\n- Express is the safety net — treat it as hot standby\n\n## VERIFICATION CHECKLIST (post-cutover)\n- [ ] Calendar page loads events\n- [ ] Event detail modal opens\n- [ ] Event creation works (including recurring with RRULE)\n- [ ] Organizer list loads with data\n- [ ] Organizer detail view shows description, images, types\n- [ ] Venue search works\n- [ ] Venue proximity check works (VenueModalAddWithSearch)\n- [ ] Login flow works (UserLogins_GetByFirebaseId)\n- [ ] Health checks return 200\n- [ ] AF invocation report shows 20+ active functions\n- [ ] No 4xx/5xx spike in App Insights\n\n## CONTACTS\n- Fulton: AF backend issues\n- Quinn: Arbitration / coordination\n- El Gotan: Final authority\n\n## CURRENT STATE\n- AF PROD: v1.20.1, 51 functions, healthy\n- FE PROD: v1.15.0 (about to be v1.16.0)\n- Express: Running, serving all user traffic\n- Vercel: AF_ENABLED=false"
}
