{
  "from": "sarah",
  "to": ["sarah"],
  "date": "2026-01-29T16:00:00.000Z",
  "subject": "MasteredLocations FE Audit - Full Lineage Report",
  "priority": "high",
  "type": "self-documentation",
  "body": "COMPREHENSIVE AUDIT: masteredLocations usage across TangoTiempo frontend (2026-01-29)\n\n## CONCLUSION\nMost user-facing masteredLocations access has been commented out or disabled. El Gotan was mostly correct.\n\n## ACTIVE paths hitting /api/masteredLocations/* endpoints:\n\n### 1. VenueModalList (USER-FACING)\n- File: src/app/components/Modals/Venues/VenueModalList.js\n- Uses useMasteredLocations hook\n- Calls: fetchCountries, fetchRegions, fetchDivisions, fetchCities\n- Purpose: Country > Region > Division > City cascading dropdowns for venue filtering\n- THIS IS THE MAIN REMAINING USER-FACING CONSUMER\n\n### 2. LocationAPIContext (INFRASTRUCTURE)\n- File: src/app/contexts/LocationAPIContext.js (renamed from MasteredLocationContext)\n- Mounted in Providers.js\n- Provides: fetchNearestCity, fetchCities, fetchRegions, fetchDivisions\n- Calls: /api/masteredLocations/nearestMastered, cities, regions, divisions\n- Used by GeoLocationContext for initialization\n\n### 3. GeoLocationContext (INFRASTRUCTURE)\n- File: src/app/contexts/GeoLocationContext.js\n- Uses useLocationAPI() for fetchNearestCity at initialization\n- Resolves user's nearest mastered city from coordinates\n\n## IMPORTANT: Venue create/edit does NOT call masteredLocations directly\n- VenueModalAdd, VenueModalEdit, VenueModalAddWithSearch all use /api/venues/geocode\n- The BACKEND does the nearestMastered lookup and returns mastered fields in geocode response\n- Frontend stores: masteredCityId, masteredDivisionId, masteredRegionId, masteredCountryId\n- These are display-only fields returned by the backend\n\n## DEAD CODE (exists but never rendered/reachable):\n\n1. LocationSelector - src/app/components/LocationSelector.js\n   - Mounted via LocationPromptManager in Providers.js\n   - BUT useLocationPrompt hook hardcodes showLocationSelector = false\n   - Uses useMasteredLocations for cascading dropdowns - NEVER SHOWN\n\n2. LocationContextModal - src/app/components/Modals/misc/LocationContextModal.js\n   - Full Leaflet map implementation with city markers\n   - Removed from SidebarDrawer: '// LocationContextModal removed - using map center mode only'\n   - NOT RENDERED ANYWHERE\n\n3. LocationLogger (old) - src/app/utils/LocationLogger.js\n   - Uses useMasteredLocations for IP-based nearestMastered\n   - NOT MOUNTED in Providers.js (Providers uses MasteredLocationLogger instead)\n   - MasteredLocationLogger is a no-op (logging removed by TIEMPO-276)\n\n4. useMasteredCities hook - src/app/hooks/useMasteredCities.js\n   - Fetches all 4 hierarchy levels in parallel\n   - ZERO consumers anywhere in the codebase\n\n## DOCUMENTATION UPDATED:\n- public/Playbook/calendar-be-af/af-current-state.md - Updated with deployed AF functions, masteredLocations audit section\n- public/Playbook/tango-tiempo/Contexts.md - Updated provider hierarchy, resolved circular dependency notes, current context architecture\n\n## DEPENDENCY CHAINS:\n\nChain 1 (Active - VenueModalList):\n  VenueModalList > useMasteredLocations hook > /api/masteredLocations/* endpoints\n\nChain 2 (Active - GeoLocation init):\n  GeoLocationContext > useLocationAPI() > LocationAPIContext > /api/masteredLocations/nearestMastered\n\nChain 3 (Active - Venue geocoding, NOT masteredLocations endpoints):\n  VenueModalAdd/Edit > /api/venues/geocode > backend nearestMastered lookup > returns mastered fields\n\nChain 4 (Dead - LocationSelector):\n  LocationPromptManager > LocationSelector (never shown) > useMasteredLocations\n\nChain 5 (Dead - LocationContextModal):\n  Removed from SidebarDrawer > LocationContextModal (not rendered) > useMasteredLocations + useLocationAPI\n\n## RECOMMENDATION:\n- MasteredLocations endpoints are LOW PRIORITY for AF migration\n- VenueModalList is the only user-facing consumer\n- GeoLocationContext initialization is the other active consumer\n- Dead code cleanup could remove LocationSelector, LocationContextModal, LocationLogger, useMasteredCities\n- Consider whether VenueModalList cascading filters should remain or be replaced with map-based approach",
  "tags": ["masteredLocations", "audit", "lineage", "dead-code", "af-migration"],
  "docs_updated": [
    "public/Playbook/calendar-be-af/af-current-state.md",
    "public/Playbook/tango-tiempo/Contexts.md"
  ]
}
