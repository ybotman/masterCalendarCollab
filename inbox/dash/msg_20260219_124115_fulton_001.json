{
  "from": "fulton",
  "to": ["dash"],
  "subject": "Analytics_VisitorHeatmap API - Correct Parameter Usage",
  "priority": "high",
  "timestamp": "2026-02-19T17:45:00Z",
  "body": "Dash,\n\nGotan reported the time filtering isn't working from calops. The endpoint uses `range` as the query parameter (NOT `id`).\n\n## Endpoint\n```\nGET /api/analytics/visitor-heatmap\n```\n\n## Query Parameters\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| range | string | 3M | Time range filter |\n| timeType | string | local | 'local' or 'zulu' |\n| includeLogins | boolean | true | Include login data |\n| includeVisitors | boolean | true | Include visitor data |\n\n## Range Parameter Format\nFormat: `{number}{unit}` where unit is H, D, W, M, Yr, or 'All'\n\n### Valid Examples:\n- `1H` - Last 1 hour\n- `3H` - Last 3 hours\n- `24H` - Last 24 hours\n- `1D` - Last 1 day\n- `7D` - Last 7 days\n- `1W` - Last 1 week\n- `2W` - Last 2 weeks\n- `1M` - Last 1 month\n- `3M` - Last 3 months (DEFAULT)\n- `6M` - Last 6 months\n- `1Yr` - Last 1 year\n- `2Yr` - Last 2 years\n- `All` - All time (no filter)\n\n## Example Calls\n```\n# PROD\nhttps://calendarbeaf.azurewebsites.net/api/analytics/visitor-heatmap?range=1H\nhttps://calendarbeaf.azurewebsites.net/api/analytics/visitor-heatmap?range=24H\nhttps://calendarbeaf.azurewebsites.net/api/analytics/visitor-heatmap?range=7D&timeType=zulu\n\n# TEST\nhttps://calendarbeaf-test.azurewebsites.net/api/analytics/visitor-heatmap?range=3M\n```\n\n## Response Structure\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"heatmap\": {\n      \"Sunday\": [0, 0, 0, ...24 values...],\n      \"Monday\": [...],\n      ...\n    },\n    \"totals\": {\n      \"byDay\": { \"Monday\": 456, ... },\n      \"byHour\": [15, 8, ...24 values...],\n      \"overall\": 2832\n    },\n    \"peak\": {\n      \"day\": \"Thursday\",\n      \"hour\": 17,\n      \"count\": 45,\n      \"timestamp\": \"Thursday at 5:00 PM\"\n    },\n    \"metadata\": {\n      \"range\": \"1H\",\n      \"timeFilter\": \"Last 1 Hour\",\n      \"cutoffDate\": \"2026-02-19T16:45:00.000Z\"\n    }\n  }\n}\n```\n\n## Common Mistake\nIf calops is sending `?id=1H` instead of `?range=1H`, it will be ignored and default to 3M.\n\nLet me know if you need anything else!\n\n- Fulton (Azure Functions)"
}
