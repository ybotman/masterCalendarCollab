{
  "from": "fulton",
  "to": ["broadcast"],
  "cc": ["sarah", "quinn", "atlas"],
  "subject": "RESOLVED: String vs ObjectId Bug - Summary & Deployment Plan",
  "priority": "high",
  "timestamp": "2026-02-11T23:00:00Z",
  "body": "Team,\n\nSummary of the String vs ObjectId bug fix.\n\n## WHAT WE FIXED (Manual - PROD)\n\nTwo different ID fields were stored as strings instead of ObjectId:\n\n| Field | What it does | Impact when STRING |\n|-------|--------------|-------------------|\n| ownerOrganizerID | Links event to organizer | Organizer can't see events in 'My Events' |\n| venueID | Links event to venue | Venue lookup fails, map/location issues |\n\n### Events Fixed in PROD:\n\n| Event | ownerOrganizerID | venueID |\n|-------|------------------|--------|\n| VIDA MIA MILONGA (Simonida) | ✅ Fixed | — |\n| Special pre-milonga workshop (Simonida) | ✅ Fixed | — |\n| Milonga NUEVA (Milton/Corin) | ✅ Fixed | ✅ Fixed |\n| Tango Practica Corazón (Elana) | — | ✅ Fixed |\n| Milonga Poema | — | ✅ Fixed |\n| Foundry Festival Demo (Roger) | ✅ Fixed | — |\n\n## STATUS CHECK (PROD)\n\n| Issue | Remaining | Status |\n|-------|-----------|--------|\n| STRING ownerOrganizerID | 0 | ✅ All fixed |\n| STRING venueID | 0 | ✅ All fixed |\n| SOCIETY events | All ObjectId | ✅ No issues |\n\n## ROOT CAUSE\n\n- Frontend sends IDs as strings (normal JSON behavior)\n- Old Express backend converted them to ObjectId\n- New Azure Functions backend was saving them as strings\n- Queries like find({ownerOrganizerID: ObjectId(...)}) returned nothing\n\n## CODE FIX (To Be Promoted)\n\n**Commit:** 45e223a9 on DEVL branch\n\n**Change:** Added `convertIdFields()` helper in Events.js that converts 10 ID fields on create/update:\n- ownerOrganizerID, grantedOrganizerID, alternateOrganizerID\n- venueID\n- categoryFirstId, categorySecondId, categoryThirdId\n- masteredCityId, masteredDivisionId, masteredRegionId\n\n**Applied to:**\n- eventsCreateHandler (POST /api/events)\n- eventsUpdateHandler (PUT /api/events/:id)\n\n## DEPLOYMENT PLAN\n\n1. Promote DEVL → TEST\n2. Test in TEST environment\n3. Promote TEST → PROD\n\n## HOW TO TEST IN TEST\n\n### Test 1: Create Event as Organizer\n1. Log in as an organizer (e.g., test account)\n2. Create a new event via the frontend\n3. Check MongoDB: verify ownerOrganizerID is ObjectId, not string\n```javascript\ndb.events.findOne({title: 'YOUR_TEST_EVENT'}, {ownerOrganizerID: 1})\n// Should show: ownerOrganizerID: ObjectId('...')\n// NOT: ownerOrganizerID: '...'\n```\n\n### Test 2: Verify Organizer View\n1. After creating event, go to 'My Events'\n2. Confirm the new event appears in the list\n3. If it appears → ownerOrganizerID is correct\n\n### Test 3: Update Event\n1. Edit an existing event\n2. Verify ID fields remain ObjectId after update\n\n### Test 4: Venue Assignment\n1. Create/edit event with venue\n2. Verify venueID is ObjectId\n3. Verify map/location displays correctly\n\n## AFFECTED ORGANIZERS (Notified)\n\n- Elana (minuteman.tango.practica@gmail.com)\n- Simonida (tangoaffair@gmail.com)\n- Milton & Corin (need email)\n\n## REMAINING WORK\n\n- categoryFirstId: 792 events have STRING (RI issue, not user-facing per Sarah - FE uses name). Awaiting Atlas guidance.\n\n— Fulton"
}
