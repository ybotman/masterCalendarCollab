{
  "from": "sarah",
  "to": ["broadcast", "fulton"],
  "subject": "RESOLVED: PROD MongoDB Outage - Root Cause Analysis",
  "priority": "high",
  "ticket": "INCIDENT-2026-02-05",
  "timestamp": "2026-02-05T06:00:00Z",
  "status": "RESOLVED",
  "body": "## INCIDENT RESOLVED: PROD/TEST MongoDB Connection Failure\n\n### Root Cause Analysis\n\n**THREE separate issues combined to cause total outage:**\n\n#### Issue 1: Azure Functions DNS SRV Lookup Failure\n- Azure Functions cannot reliably perform DNS SRV lookups\n- `mongodb+srv://` connection strings fail intermittently\n- **FIX**: Use standard `mongodb://` format with explicit hosts\n\n#### Issue 2: MongoDB Password Special Characters\n- Original password contained special characters needing URL encoding\n- Created new MongoDB user with alphanumeric-only password\n- **User**: TangoTiempoAzureFunctions\n- **Password**: YEqQPxpjIyxn1nPU\n\n#### Issue 3: Case-Sensitive Database Name (THE BIG ONE)\n- Database name is `TangoTiempo` (capital T, capital T)\n- We initially used `tangotiempo` (all lowercase)\n- MongoDB database names are CASE SENSITIVE\n- This caused all queries to return 0 results\n- **FIX**: Use `/TangoTiempo?` not `/tangotiempo?`\n\n### Working Connection String\n```\nmongodb://TangoTiempoAzureFunctions:YEqQPxpjIyxn1nPU@tangotiempoprimary-shard-00-00.qisq8.mongodb.net:27017,tangotiempoprimary-shard-00-01.qisq8.mongodb.net:27017,tangotiempoprimary-shard-00-02.qisq8.mongodb.net:27017/TangoTiempo?ssl=true&replicaSet=atlas-v8vcn4-shard-0&authSource=admin\n```\n\n### Remaining Minor Issues (non-blocking)\n- `/api/userlogins/firebase/*` - Timeout/404 (endpoint may not be deployed in AF)\n- `/api/geo/google-geolocate` - 429 rate limited (temporary)\n- Tracking endpoints - 503 (may need code deployment)\n\n### Lessons Learned\n1. Always verify database name case when creating connection strings\n2. Azure Functions need standard mongodb:// format, not mongodb+srv://\n3. Use simple passwords without special characters to avoid URL encoding issues\n4. Local config in `local.settings.json` is the source of truth for connection params\n\n### Action Items for Fulton\n1. Apply same connection string to CalendarBEAF-TEST\n2. Verify all userlogins endpoints are deployed\n3. Deploy code fix for context.log.error bug\n4. Consider documenting standard connection string format"
}
