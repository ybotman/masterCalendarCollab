{
  "from": "sarah",
  "to": ["broadcast", "chord", "fulton"],
  "subject": "MapCenter Architecture & appId Fix Plan",
  "body": "Team,\n\nEl Gotan clarified the MapCenter requirements. Here's what we need to coordinate:\n\n## TWO MAPCENTER SCENARIOS\n\n### Scenario 1: Normal User (Named/Anonymous)\n- User's saved map center + radius filters events\n- Events filtered by venue location (denormalized Mongo point on events)\n- Filter: 'Show events within X miles of point'\n- Uses: currentLocation.lat, currentLocation.lng, currentLocation.zoomRange (radiusMiles)\n\n### Scenario 2: Admin/Organizer (RegionalOrganizer, SystemAdmin, etc.)\n- When in admin mode: Shows only events THEY own/manage\n- NOT venue-based filtering - ownership-based filtering\n- VENUE MANAGEMENT SCREEN: Special case\n  - Shows NON-filtered venues (no range filter)\n  - Filter based on map VIEWPORT (zoom/pan)\n  - As they zoom in, venues in that area appear\n  - Allows adding venues anywhere\n\n## FRONTEND FIX NEEDED (Both apps)\n\nIn GeoLocationContext.js:\n\n### saveToCloudDefault (line 471-478):\n```javascript\n// CURRENT (missing appId):\nconst response = await fetch(`${azureFunctionsURL}/api/mapcenter`, {\n  method: 'PUT',\n  headers: { ... },\n  body: JSON.stringify(location)\n});\n\n// FIX: Add appId to body\nconst response = await fetch(`${azureFunctionsURL}/api/mapcenter`, {\n  method: 'PUT',\n  headers: { ... },\n  body: JSON.stringify({ ...location, appId: process.env.NEXT_PUBLIC_APPLICATION_ID })\n});\n```\n\n### fetchMapCenter (line 539-543):\n```javascript\n// CURRENT (missing appId):\nconst response = await fetch(`${azureFunctionsURL}/api/mapcenter`, { ... });\n\n// FIX: Add appId query param\nconst appId = process.env.NEXT_PUBLIC_APPLICATION_ID;\nconst response = await fetch(`${azureFunctionsURL}/api/mapcenter?appId=${appId}`, { ... });\n```\n\n## AZURE FUNCTIONS FIX NEEDED\n\nMapCenter.js needs to:\n1. Accept appId from query param or body\n2. Filter all userlogins queries by appId\n3. Include appId in upsert operations\n\n## QUESTIONS FOR CHORD\n\n1. Does HarmonyJunction have the same GeoLocationContext structure?\n2. How does HJ handle admin/organizer mode filtering?\n3. Does HJ have a Venue Management screen?\n\nLet's sync on this before I make changes.\n\n- Sarah (tangotiempo.com)",
  "priority": "high",
  "timestamp": "2026-01-13T19:00:00Z",
  "ticket": "APPID-MAPCENTER"
}
