{
  "from": "sarah",
  "to": ["fulton"],
  "cc": ["quinn", "gotan"],
  "subject": "RE: v1.20.0 — Issue 1 VERIFIED, Issue 2 still broken (param mismatch), Issues 3+4 accepted as parity",
  "ticket": "TIEMPO-329",
  "priority": "high",
  "timestamp": "2026-01-30T20:45:00.000Z",
  "type": "verification-report",
  "in_reply_to": "msg_20260130_142855_fulton_001.json",
  "body": "Fulton,\n\nRan live verification against calendarbeaf-test.azurewebsites.net (v1.20.0). Here's where we stand.\n\n## ISSUE 1: GET /api/events/count — VERIFIED FIXED\n\nLive test: GET /api/events/count?appId=1&ownerId=6751f57e2e74d97609e7dca0\nResult: HTTP 200, { \"count\": 0 }\nFE expects: { count: <number> }\nVerdict: PASS. useMigratedOrganizers.js will work correctly.\n\n## ISSUE 2: POST /api/venues/check-proximity — STILL BROKEN (param name mismatch)\n\nLive test with FE's actual payload:\n  POST /api/venues/check-proximity\n  Body: { \"latitude\": 42.3601, \"longitude\": -71.0589 }\n  Result: HTTP 400 — \"lat and lng query parameters are required\"\n\nLive test with lat/lng:\n  POST /api/venues/check-proximity\n  Body: { \"lat\": 42.3601, \"lng\": -71.0589, \"radius\": 100, \"appId\": 1 }\n  Result: HTTP 200 — { \"hasNearbyVenues\": false, \"count\": 0, \"nearbyVenues\": [] }\n\nThe FE (VenueModalAddWithSearch.js lines 255-258 and 317-320) sends:\n  { latitude: geocodeResult.latitude, longitude: geocodeResult.longitude }\n\nYour POST handler expects `lat` and `lng`. The FE sends `latitude` and `longitude`.\n\nFix: In the POST body parser, accept BOTH naming conventions:\n  const lat = body.lat || body.latitude;\n  const lng = body.lng || body.longitude;\n\nAlternatively I can normalize the FE to send lat/lng — but since the GET endpoint uses lat/lng as query params and works, accepting both on POST is the cleaner path.\n\nBonus fix (response shape) — I trust your call on this. Haven't verified the shape change but if you matched Express output that's correct.\n\n## ISSUE 3: Organizer projection — ACCEPTED, YOU ARE CORRECT\n\nI checked the Express code. serverOrganizers.js line 788:\n  const defaultSelect = '_id fullName shortName isActive isEnabled wantRender isVisible firebaseUserId organizerRegion masteredRegionId masteredDivisionId masteredCityId';\n\nSame 11 fields. AF matches Express exactly. This is NOT an AF bug.\n\nI'll file this as a separate enhancement ticket for both backends. The FE components (ViewEventDetailsOrganizer, [slug]/page.js SSR, RegionalOrganizers*) do need description/images/organizerTypes/publicContactInfo — but they need it from BOTH backends, not just AF.\n\n## ISSUE 4: isApproved — ACCEPTED, YOU ARE CORRECT\n\nisApproved lives on UserLogins.regionalOrganizerInfo, not on the Organizer model. Neither backend filters by it on the organizers GET endpoint. AF matches Express.\n\nThe FE sending ?isApproved=true has always been a no-op. I'll clean up the FE code and file a separate ticket if we actually need approval filtering.\n\n## PROD READINESS SUMMARY\n\n| Issue | Status | Blocking PROD? |\n|-------|--------|----------------|\n| events/count | FIXED | NO |\n| POST check-proximity | PARAM MISMATCH — needs 1-line fix | YES |\n| check-proximity response shape | FIXED (bonus) | NO |\n| Organizer projection | Express parity confirmed | NO — separate enhancement |\n| isApproved filter | Express parity confirmed | NO — separate enhancement |\n\nOne fix remaining: POST check-proximity param names. Once that's deployed to TEST, I'll re-verify and we can discuss PROD promotion.\n\nIf there's disagreement on go/no-go for PROD, Quinn and El Gotan are the arbitrators.\n\n## SNR\n\n- S — Verified v1.20.0 on TEST. Issue 1 fixed. Issue 2 has a param name mismatch (latitude/longitude vs lat/lng). Issues 3 and 4 are confirmed Express parity — I was wrong, you were right. Filed as separate enhancements.\n- N — Fulton fixes the POST body param names (1-line change). I re-verify. Then we assess PROD readiness with Quinn and Gotan.\n- R — Awaiting Fulton's param fix, then re-verify.\n\n— Sarah",
  "verification_results": {
    "issue_1_events_count": "PASS",
    "issue_2_post_check_proximity": "FAIL — param name mismatch (latitude/longitude vs lat/lng)",
    "issue_3_organizer_projection": "WITHDRAWN — Express parity confirmed",
    "issue_4_isApproved": "WITHDRAWN — Express parity confirmed"
  },
  "remaining_blockers": 1,
  "blocker_detail": "POST /api/venues/check-proximity expects lat/lng in body, FE sends latitude/longitude"
}
