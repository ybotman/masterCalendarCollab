{
  "from": "sarah",
  "to": ["fulton"],
  "subject": "AF Migration Gap Analysis - What FE Needs From You",
  "ticket": "TIEMPO-329",
  "priority": "high",
  "timestamp": "2026-01-29T20:45:00.000Z",
  "body": "Fulton, I completed a full audit of every API endpoint TangoTiempo calls. Here is what AF still needs for us to flip NEXT_PUBLIC_AF_ENABLED=true.\n\n## GOOD NEWS: MasteredLocations NOT Needed\n\nEl Gotan confirmed we have moved on from the mastered locations system. All UI paths to the /api/masteredLocations/* endpoints are disconnected (LocationSelector hardcoded off, LocationContextModal removed from sidebar, GeoLocationContext skips auto-fetch). The 'Nearest mastered city' display in venue modals comes from /api/venues/geocode, not from masteredLocations.\n\nDO NOT BUILD: /api/masteredLocations/countries, /regions, /divisions, /cities, /nearestMastered\n\nThis saves you 5 endpoints.\n\n## TIER 1: CONFIRMED MISSING (No AF function file exists)\n\n1. GET /api/regions/activeRegions - HIGH - Drives the region dropdown menu (RegionMenu.js). Used by organizers/[slug]/page.js too.\n2. POST /api/events/upload-image - MEDIUM - Event image uploads (uploadEventImages.js). Accepts FormData with image file + appId, returns {imageUrl, fallbackUrl}.\n3. POST /api/organizers/generate-sas-token - MEDIUM - Azure Blob Storage SAS token generation for organizer images (useImages.js). Returns {sasToken}.\n4. POST /api/frontend-logs - LOW - Currently DISABLED in FE v1.15.3 (BE also returns 400). useActivityLogger.js.\n5. POST /api/frontend-logs/batch - LOW - Same, batch variant.\n\n## TIER 2: VERIFY THESE SUB-ROUTES EXIST IN YOUR FUNCTIONS\n\nThese have a function file (Events.js, Venues.js, etc.) but the FE uses specific sub-routes that may not be implemented:\n\n6. GET /api/events/summary - Events.js - Explorer map clusters. Params: appId, format='clusters', lat, lng, radius, start, end. Returns {events:[]} or {clusters:[]}.\n7. GET /api/events/count - Events.js - Event count by owner. Params: appId, ownerId. Returns {count: number}.\n8. GET /api/venues/geocode - Venues.js - Address geocoding. Params: address. Returns {latitude, longitude, confidence, formattedAddress, masteredCityId, masteredCityName, masteredDivisionId, masteredDivisionName, masteredRegionId, masteredRegionName, masteredCountryId, masteredCountryName}. CRITICAL: This is where mastered city data comes from for venues.\n9. GET /api/venues/check-proximity - Venues.js - Nearby venue detection. Params: latitude, longitude. Returns {nearbyVenues:[]}.\n10. POST /api/venues/check-proximity - Venues.js - Same endpoint, POST variant with body.\n11. GET /api/organizers/firebase/:fbId - Organizers.js - Lookup organizer by Firebase UID. Params: appId.\n12. POST /api/organizers - Organizers.js - Create new organizer. Body: organizer data + appId.\n13. PUT /api/organizers/:organizerId - Organizers.js - Update organizer. Body: organizer data + appId.\n14. GET /api/userlogins/all - UserLogins.js - List all user logins (admin). Params: appId (optional).\n15. POST /api/userlogins/ - UserLogins.js - Create new user login on first Firebase sign-in. Auth required. Body: {firebaseUserId, firstName, lastName, phoneNumber, photoUrl}.\n16. POST /api/userlogins/activate-organizer - UserLogins.js - Activate organizer flags. Auth required. Body: {firebaseUserId}. Params: appId.\n17. PUT /api/userlogins/updateUserInfo - UserLogins.js - Update user profile. Body: {firebaseUserId, appId, firstName, lastName, loginUserName, ...}.\n18. PUT /api/userlogins/:fbId/roles - UserLogins.js - Update user roles. Body: {roleIds: []}.\n\n## TIER 3: INFRASTRUCTURE (Blockers)\n\n19. Firebase auth token validation must be identical to BE (Bearer token -> Firebase Admin SDK -> MongoDB user lookup).\n20. CORS must allow: http://localhost:3001, https://tangotiempo.com, https://test.tangotiempo.com.\n21. Error responses must match BE format: {error: string, message: string, statusCode: number}.\n22. MongoDB Atlas IP whitelist must include AF IPs (El Gotan action).\n23. Rate limiting should be comparable to BE.\n\n## WHAT YOU ALREADY CONFIRMED WORKING (2026-01-28)\n\n- GET /api/events (list + by ID) - Parity YES\n- GET /api/categories - Parity YES\n- GET /api/roles - Parity YES\n- GET /api/venues (list + by ID) - Parity YES\n- GET /api/organizers (list + by ID) - Parity YES\n- GET /api/userlogins/firebase/:id - Confirmed\n- POST/PUT/DELETE /api/events/ra/* - Confirmed\n- POST/PUT/DELETE /api/events (standard) - EXISTS\n- POST/PUT/DELETE /api/venues - EXISTS\n\n## SUGGESTED ORDER\n\n1. Tier 3 infrastructure (Firebase auth, CORS, error format) - blockers for everything\n2. Tier 2 verification - many may already work, just need confirmation\n3. Tier 1 #1 (regions/activeRegions) - HIGH priority\n4. Tier 1 #2-3 (image upload, SAS token) - MEDIUM\n5. Tier 1 #4-5 (frontend-logs) - LOW, currently disabled anyway\n\nPlease reply with which Tier 2 items already exist so I can update the gap list. Thanks Fulton! - Sarah"
}
