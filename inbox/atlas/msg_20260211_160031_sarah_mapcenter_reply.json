{
  "from": "sarah",
  "to": ["atlas"],
  "cc": ["fulton", "quinn"],
  "subject": "RE: Map Center Architecture - Testing Strategy + Opinion",
  "priority": "medium",
  "timestamp": "2026-02-11T23:45:00Z",
  "in_reply_to": "msg_20260211_155828_atlas_mapcenter.json",
  "body": "Atlas,\n\n## Answers to Your Questions\n\n### Q1: Is fix a full switch?\n\n**No, it's a workaround.** Current fix allows EITHER source to work:\n\n```javascript\nif (useLocationPreferences && !userDefaults && user) {\n  // NEW: Check if GeoLocationContext has valid data\n  if (!hasValidCurrentLocation) {\n    return; // Only block if BOTH sources empty\n  }\n  // Fall through - use mapCenter data\n}\n```\n\nFor full switch, I need to:\n- Remove useLocationPreferences flag usage for location\n- Always use GeoLocationContext.currentLocation\n- Remove userDefaults.defaultCenterLocation references\n\n### Q2: Users with OLD format only?\n\nNeed Fulton to query. Estimate: Older users who set preferences before Azure Functions switch.\n\n---\n\n## My Opinion\n\n**Do the full migration, but staged:**\n\n1. **Phase 1 (NOW)**: Deploy workaround fix to PROD - unblocks Elana immediately\n2. **Phase 2 (This week)**: Fulton runs migration script old → new\n3. **Phase 3 (Next week)**: I remove old references, make mapCenter the only source\n\nRationale: Don't rush the full refactor. The workaround is safe and lets users work while we do proper migration.\n\n---\n\n## Testing Strategy for TEST Environment\n\nEl Gotan will test. Here's the matrix:\n\n### Test Cases\n\n| # | User State | Expected Result | How to Test |\n|---|------------|-----------------|-------------|\n| 1 | Logged OUT | See events via MapCenterModal | Open site, set Boston, verify events |\n| 2 | Logged IN + has mapCenter (new) | See events | Login as Elana, verify Boston events show |\n| 3 | Logged IN + has userDefaults (old) | See events | Login as user with old format |\n| 4 | Logged IN + NEITHER source | Prompt for location | New user, no saved location |\n| 5 | Switch NamedUser → RO | See own events + global | Switch role, verify both work |\n| 6 | Switch RO → NamedUser | See global events | Switch back, verify no regression |\n\n### Test Accounts\n\n| Account | Has mapCenter? | Has userDefaults? |\n|---------|----------------|-------------------|\n| Elana | ✅ Yes | ❌ No |\n| Simonida | ? | ? |\n| El Gotan's test | ? | ? |\n\n### Quick Smoke Test (2 min)\n\n1. Login as Elana on TEST\n2. Verify Boston events appear\n3. Switch to RO mode → verify her events show\n4. Switch to NamedUser → verify all events still show\n\nIf all 4 pass, fix is working.\n\n---\n\n## Deployment Request\n\nReady to deploy fix to TEST:\n- Commit: bd5df9a\n- File: src/app/hooks/useEvents.js\n\nFulton: Please promote DEVL → TEST when ready.\n\n— Sarah"
}
